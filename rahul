import boto3

def lambda_handler(event, context):
    try:
        # Extract the action from the event
        if 'source' in event and event['source'] == 'aws.events':
            action = event.get('detail', {}).get('action')
        else:
            action = event.get('action')
        
        # Validate and process the action
        if action == 'start':
            cluster_name = 'sag-ECS-cluster'
            service_name = 'service_for_ecs'
            task_definition_arn = 'arn:aws:ecs:ap-south-1:927689643452:task-definition/mynodeapp-new:60'
            ecs_client = boto3.client('ecs')

            response = ecs_client.update_service(
                cluster=cluster_name,
                service=service_name,
                taskDefinition=task_definition_arn,
                desiredCount=1
            )
            
            custom_input = event.get('customInput', {})
            return {
                'statusCode': 200,
                'body': 'ECS service started with a new task definition!',
                'customInputReceived': custom_input
            }

        elif action == 'stop':
            cluster_name = 'sag-ECS-cluster'
            service_name = 'service_for_ecs'
            task_definition_arn = 'arn:aws:ecs:ap-south-1:927689643452:task-definition/mynodeapp-new:60'
            ecs_client = boto3.client('ecs')

            response = ecs_client.update_service(
                cluster=cluster_name,
                service=service_name,
                taskDefinition=task_definition_arn,
                desiredCount=0
            )
            
            custom_input = event.get('customInput', {})
            return {
                'statusCode': 200,
                'body': 'ECS service stopped!',
                'customInputReceived': custom_input
            }

        else:
            return {
                'statusCode': 400,
                'body': 'Invalid action. Use "start" or "stop".'
            }

    except Exception as e:
        return {
            'statusCode': 500,
            'body': str(e)
        }
